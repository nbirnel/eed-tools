<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>/cygdrive/u/SHARED/GENERAL/_SoftwareRepository/noahtools/opt2lfp/opt2lfp.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v6">
<meta name="syntax" content="awk">
<meta name="settings" content="use_css">
<style type="text/css">
<!--
pre { font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
.Statement { color: #c00000; }
.Identifier { color: #8080ff; }
.Constant { color: #ff40ff; }
.Special { color: #ff40ff; }
.Comment { color: #ff6060; }
-->
</style>
</head>
<body>
<pre>
<span class="Comment">#!/bin/awk -f</span>

<span class="Special">BEGIN</span> {
    <span class="Comment">#FIXME why does this cause a bug?!</span>
<span class="Comment">#    RS = &quot;\r\n&quot;</span>
    <span class="Special">ORS</span> = <span class="Constant">&quot;</span><span class="Special">\r\n</span><span class="Constant">&quot;</span>
    <span class="Special">FS</span> = <span class="Constant">&quot;,&quot;</span>
    <span class="Special">OFS</span> = <span class="Constant">&quot;,&quot;</span>
    imop = <span class="Constant">&quot;IM&quot;</span>
    offset = <span class="Constant">&quot;0&quot;</span>  <span class="Comment"># FIXME we should adjust this for pdfs</span>
}

<span class="Comment">#input </span>
<span class="Comment">#IMG0001,VOLUME01,x:\windows\path\to\image\IMG0001.TIF,Y,,6</span>
<span class="Comment">#output</span>
<span class="Comment">#IM,IMG0001,D,0,@VOLUME01;x:\windows\path\to\image;IMG0001.TIF;2</span>

<span class="Comment">#FIXME check for correct formation?</span>
<span class="Comment">#remove dumb byte order mark by default?</span>
{

    key   = <span class="Special">$1</span>
    vol   = <span class="Constant">&quot;@&quot;</span> <span class="Special">$2</span>
    path = img = fpath = <span class="Special">$3</span>
    brk   = <span class="Special">$4</span>
    noop1 = <span class="Special">$5</span>
    noop2 = <span class="Special">$6</span>
    pp    = <span class="Special">$7</span>

    doc = (brk == <span class="Constant">&quot;Y&quot;</span> ? <span class="Constant">&quot;D&quot;</span> : <span class="Constant">&quot; &quot;</span>)

    <span class="Identifier">sub</span>(<span class="Constant">/</span><span class="Special">\\</span><span class="Constant">[^</span><span class="Special">\\</span><span class="Constant">]</span><span class="Special">*$</span><span class="Constant">/</span><span class="Special">,</span> <span class="Constant">&quot;&quot;</span><span class="Special">,</span> path)

    <span class="Identifier">sub</span>(<span class="Constant">/</span><span class="Special">^.*</span><span class="Special">\\</span><span class="Constant">/</span><span class="Special">,</span> <span class="Constant">&quot;&quot;</span><span class="Special">,</span> img)

    ext = <span class="Identifier">tolower</span>(img)
    <span class="Identifier">sub</span>(<span class="Constant">/</span><span class="Special">.*</span><span class="Special">\.</span><span class="Constant">/</span><span class="Special">,</span> <span class="Constant">&quot;&quot;</span><span class="Special">,</span> ext)
    <span class="Statement">if</span> (ext == <span class="Constant">&quot;jpg&quot;</span>) {
        type = <span class="Constant">4</span>
    } <span class="Statement">else</span> <span class="Statement">if</span> (ext == <span class="Constant">&quot;tif&quot;</span>) {
        type = <span class="Constant">2</span>
    } <span class="Statement">else</span> <span class="Statement">if</span> (ext == <span class="Constant">&quot;pdf&quot;</span>) {
        type = <span class="Constant">7</span>
    }

    outpath = vol <span class="Constant">&quot;;&quot;</span> path <span class="Constant">&quot;;&quot;</span> img <span class="Constant">&quot;;&quot;</span> type
    <span class="Statement">print</span> imop<span class="Special">,</span> key<span class="Special">,</span> doc<span class="Special">,</span> offset<span class="Special">,</span> outpath
}





</pre>
</body>
</html>
